# 1、基础概念

量化投资是利用统计学、数学、信息技术、人工智能等方法取代人工作出决策，通过模型完成股票交易来构建投资组合。利用计算机技术和数学模型去实现投资策略的过程

量化投资的优势表现在以下三方面：
- 投资范围更广泛：借助计算机技术，信息搜集更具速度和广度，分析范围覆盖整个市场，促进获得更多投资机会。
- 程序化交易，避免主观因素：通过回测证实或证伪策略的有效性，程序化交易自动下单，克服人性弱点，避免人为情绪等主观因素的干扰。
- 数据处理快速响应，创造交易价值：采用计算机自动分析，响应速度迅速，拥有强大的数据处理和信息挖掘能力，支撑高频交易，并验证每个决策背后的模型有效性，更有可能创造有效的交易价值

# 2、量化交易流程

量化投资的一般流程包括以下几个步骤：
- 数据获取
- 数据清洗
- 策略设计：基于金融理论、历史数据或其他分析方法，构建量化投资策略的想法。
- 回测验证：使用历史数据对策略进行回测，检验策略的有效性和可行性，以及找到优化策略的方法。
- 策略优化
- 模拟盘验证：使用虚拟账户和资金进行模拟交易，检验策略在实际市场中的表现，调整和优化策略。
- 实盘交易：经过前面的验证和优化后，将策略投入实际交易中执行。

需要注意的是，量化投资的策略设计和实施过程需要严谨、科学、系统化的方法，同时也需要一定的技术和数学功底。成功的量化投资不仅仅依赖于策略的设计，也需要严格的风险控制和资金管理。

## 2.1、数据获取

主要内容：
- 行情数据
- 宏观数据：政策
- 财务数据：上市公司的报表
- 舆情数据：正负面的新闻

方式：
- 网站下载
- 客户端
- 三方 API
- 爬虫

## 2.2、数据清晰

- 垃圾数据清除
- 空值填充
- 格式转换
- 数据对齐

常用类库
- Numpy
- pandas

## 2.3、策略设计

- 信号捕捉：交易信号
- 交易
    - 建仓
    - 平仓

## 2.4、策略回测

- 回测参数设置
- 策略实例化
- 历史数据载入
- 回测执行
- 计算盈亏
- 计算统计指标
- 生成回测报告

# 3、量化交易策略分类

分类体系
- 交易产品
- 盈利模式
- 策略信号

## 3.1、交易产品策略

- 股票策略：股份公司为筹集资金而发行给各个股东作为持股凭证并借以取得股息和红利的一种有价证券，通过股价波动盈利
- 期权策略：期权合约差价，到期行权收益；买入一份低行权价认购期权，同时卖出一份高行权价认购期权
- CTA 策略，针对期货，关注价格趋势获取利差；价格走势存在反身性,随着市场上涨或下跌的趋势得到加强,而认知上的偏移又会反映在市场上
- FOF 策略：Found of Fund，基金中的基金，是一种专门投资于其他投资基金的基金；通过资产配置来分散风
险、平滑波动、改善组合收益风险比,从而优化投资者的持有体验。尤其是在震荡的市场背景下,FOF产品的优势尤其明显

## 3.2、盈利模式策略

- 单边多空策略：根据股票的涨和跌还盈利的，低价买进，待股价出现单边下跌的时卖出，赚取利差；通过单边买入或单边卖出实现盈利；
- 套利策略：在金融市场利用某些金融产品价格与收益率暂时不一致的机会获得收益的策略。追求无风险套利,即价格变动所产生的无风险收益；
- 对冲策略：
    - 对冲：指特意减低另一项投资风险的投资。同时进行两笔行情相关、方向相反、数量相当、盈亏相抵的交易；
    - 对冲策略：在期货股票市场和股票市场同时进行等量反向交易,以锁定既得利润(或成本),通过抵消两个市场的损益来规避股票市场的系统性风险；
    - 做多同时做空，市场向上，赚钱；市场向下，赚钱或少亏钱

## 3.2、策略信号策略

主要有：
- 多因子
- 交易模型
- 机器学习

什么是策略信号：交易信号，买入或卖出的一系列特征

**多因子策略：** 找到某些和收益率最相关的指标,并根据该指标，建一个股票组合，期望该组合在未来的一段时间跑赢或跑输指数，因子项：
- 资产负债率
- 资产回报率
- 每股净收益
- 净利润增长率
- 市盈率

> 跑赢指数，做多；跑输指数，做空

***交易模型：** 基于现代多学科众多理论，以及多种金融技术分析理论，具有普遍性，可盈利可量化可执行交易系统；

> 市场趋势符合交易模型即可盈利

**机器学习：**从大量数据中找到某种规律，包括但不局限于文本数据，图像数据等，找到可盈利，可量化，可执行的策略信号；

> 区别于传统金融量化策略，从更丰富的数据维度中识别策略信号


主要可用策略：
- 均值回归策略
- 动量效益策略
- 策略信号
- 二八轮动策略
- 海龟策略
- 机器学习策略

# 4、股票

## 4.1、基本概念

股票：股份公司为筹集资金而发行给各个股东作为持股凭证并借以取得股息和红利的一种有价证券

分红、送股配股、交易收益、本金少、易变现、避免货币贬值 

股票基本数据
- 技术面数据：是通过股票的历史价格和交易量等市场数据进行计算和分析得出的指标；技术面数据主要关注股票价格的变动和市场趋势，常用的技术指标包括移动平均线、相对强弱指标、MACD指标等
- 基本面数据：是通过分析公司的财务状况、业绩表现、竞争力等基本信息得出的评估，基本面分析的目标是评估公司的内在价值，并基于这些评估来判断股票的投资潜力。常用的基本面指标包括市盈率、市净率、股息率等。基本面数据通常需要通过公司公开的财务报告和公告来获取

## 4.2、股票行业分类

- 中正指数
- 申万指数

股票分类的作用：
- 持续盈利：最近二十年内持续盈利，食品饮料与医药生物行业
- 传统行业：前十年表现出色,后十年表现不佳,电气设备、采掘、有色金属、传统汽车、机械设备、钢铁
- 新兴行业：前十年不怎么样,最近十年表现出色,计算机、电子、新能源、家电
- 表现不佳：最近二十年内缺乏盈利表现,公用事业、纺织服装

## 4.3、股价影响因素

股价：股票的交易价格,与股票的价值是相对的概念。股票价值的真实含义是企业资产的价值。而股价的价值就等于每股收益乘以市盈率

影响股价的基本因素
- 经济因素：主要指经济周期因素，经济衰退，股价随之下跌；经济繁荣，股价也随之上涨
- 政治因素：处交的改善会使有关跨国公司股价上升；战争使各国政治经济不稳，股价下跌，但会使军工行业股价上升
- 行业因素：行业在国民经济中地位的变更，发展前景和发展潜力，新兴行业的冲击等都会影响相关股票的价格；
- 企业自身因素：企业的经营业绩水平、本身的资产信用、股息红利的设定、外来的发展前景等等都可以影响该企业股票价格变动
- 市场因素：主要指市场交易状况、其他金融投资产品的表现、交易因素、供求关系等因素；
- 心理因素：投资人在受到各个方面的影响后产生心理状态改变，往往导致情绪波动，判断失误，这是引起股价狂跌暴涨的重要因素；

## 4.4、股票交易

### 4.4.1、常识

交易时间：
- 周一至周五(法定节假日除外)上午9:30~11:30 下午13:00~15:00

竞价成交：价格优先,时间优先
- 上午：9:15~9:25 开盘集合竞价(成交量最大的价格)
- 上午：9:30~11:30，下午 13:00~14:57 连续竞价
- 下午：14:57~15:00 收盘集合竞价(成交量最大的价格)

**交易单位**
- 报价单位股，交易单位手，100股=1手
- 股价变动单位最小为0.01元

**庄家与散户**
- 庄家：能够影响金融证券市场行情的大户投资者
- 散户：股市中投入股市资金量较小的个人投资者

**换手率：**
- 某段时期内的成交量/发行总股数
- 表征该股票交易的活跃程度
- 10~50%非常活跃，低于1%非常不活跃

**PE**：市盈率,(每股市场价格)/(每股税后利润)
- PE越高，该企业越被高估；反之，该企业越被低估；正常范围是 10~50；

### 4.4.2、K 线

将各种股票每日、每周、每月开盘价、收盘价、最高价、最低价等涨跌变化状况，用图形方式表现出来，即蜡烛图
- K线需要结合交易量分析
- 看懂K线不代表能赚钱

Python 实现类库：
- matplotlib：Matplotlib是一个 Python的2D绘图库,它以各种硬拷贝格式和跨平台的交互式环境生成出版质量级别的图形
- mpl_finance：matplotlib finance：是python中可以用来画出蜡烛图、线图的分析工具,目前已经从matplotlib中独立出来

### 4.4.3、财务知识

- ROE：收益率，越高越高，每股收益
- 净利润：越高约好
- 成长性：越高越好，主营业务利润，营业利润增长率

### 4.4.4、选股

什么是选股：通过某种手段方式，提供给投资者判断个股的依据，帮助投资者选定个股的方法，选股是股票投资的第一步

选股方法：基本面选股，基本面是：通过分析一家上市公司在发展过程中所面临的外部因素以及其自身的因素，来预测其未来的发展前景，并以此来判断该上市公司的股票是否值得买入；
- 外部因素：经济增长、财政政策、利率变化
- 内部因素：经营状况、行业地位、财务状况


**基本面选股的核心方法：股票估值**。股票估值能帮助投资者发现现价价值被低估的股票，让他们低买高卖，从而获利。股票估值常用的指标：
- 每股收益：越高越好，代表公司的盈利水平
- 市盈率：同行业市盈率越低越好，14~30 倍正常，大于 30 倍属于高估，50 倍以上存在泡沫；
- 毛利率：越高越好，毛利率大于 50%很好
- 净资产收益率：代表公司盈利能力，ROE长期保持在20%以上就是白马股
- 资产负债率：适中为好，最好在10%~40%
    - 过高，容易暴雷
    - 过低，发展保守
- 净利润增速：代表公司未来成长能力，近3年平均增速在20%以上属于优质企业，大约50%属于成长股

### 4.4.5、择时

**什么是择时：** 买入股票和卖出股票的时机，择时的好坏，决定能够赚到多少钱

**择时方法：技术分析**，从K线形态、成交量、均线、布林带、MACD与KDJ等方面出发分析,它们是反映股价变化的指标

技术分析常用工具：
- K线形态：K线图蕴含大量信息，能显示股价的强弱、多空双方的力量对比，是技术分析最常见的工具；
- 成交量：在股市中，成交量不仅可以反映出买卖数量的变化，还可以通过成交量看出多空双方的力量变化
- 均线：将某一段时间的收盘价之和除以该周期所得到的一根平均线。常用的参数有5日、10日、20日、30日、60日等
- 布林带：布林带是一种常用的技术指标,它由三条轨道线组成，其中上下两条线分别可以看成是*价格的压力线和支撑线*，在两条线之间是一条*价格平均线*
- MACD：Moving Average Convergence/Divergence，意为异同移动平均线。它刻画的是股价变化的速度；
- KDJ：中文名叫随机指标。通过价格波动的真实波幅来反映价格走势的强弱和超买超卖现象，在价格尚未上升或下降之前发出买卖信号的一种技术分析指标，适用于 **短期行情走势** 分析

## 4.5、量化交易平台

量化交易平台：可为量化交易研发人员提供所需的量化数据、策略框架、回测框架、交易接口等功能，极大提高量化交易初学者的研发效率


| 平台名称| 数据方面| 研究方面| 回测方面| 模拟交易方面| 实盘交易方面| 交流社区方面|
| ---| ---- | ---- | ---- | ---- | ---- | ----- |
| [聚宽（JoinQuant）](https://www.joinquant.com/study) | 提供2005年至今完整的股市Leve1数据、上市公司财务数据、完整的停复权信息。实时更新行情数据，盘后更新财务数据。此外还提供基金（包括ETF、LOF、分级A/B基金、货币基金）的行情和净值数据，金融期货数据、股票指数数据、行业板块数据、概念板块数据、宏观数据、行情数据等。 | 提供基于IPython Notebook的研究平台，支持Tick级数据，支持Python2、Python3。提供API（Application Programming Interface）。 | 支持股票、基金、期货等品种的回测，支持日、分钟、Tick级回测。 | 支持股票、股指期货、商品期货、ETF等品种的日、分钟、Tick级别的模拟交易。 | 和第一创业合作，支持股票、场内基金、期货的自动化实盘交易。   | “聚宽社区”，活跃度很高。     |
| [掘金（Myquant）](https://www.myquant.cn/) | 提供近10年日/分钟/Tick级别股票数据，及财务、分红送配、行业、板块等数据。还提供股指期货、商品期货的连续数据。 | 支持Python，Matlab，C，C++，C#语言。提供API。                | 支持股票、期货等品种回测及其混合回测，支持日、分钟、Tick级回测。 | 支持股票、商品期货、股指期货等品种的日、分钟级别的模拟交易。 | 需要客户申请和人工审核，具有实盘交易权限后可以手动交易。     | “掘金量化社区”，活跃度较高。 |
| [Bigquant](https://bigquant.com/) | 提供日/分钟级别的股票、期货、基金等数据的实时和历史数据，以及新闻、社交等新型数据。 | 支持Python，提供AI开发策略。提供API。                        | 支持股票、期货等品种的回测，支持日、分钟、Tick级回测。       | 支持日、分钟级别的股票、期货等品种的模拟交易。               | 可推送秒级交易信号，提供API接口对接交易终端，由用户手动交易。 | “Bigquant量化社区”，活跃度较高       |
| [米筐（Ricequant）](https://www.ricequant.com/welcome/) | 提供股票、ETF、期货（股指、国债、商品期货）、现货的基本信息。股票、ETF过去10多年以来每日市场数据，股票、ETF在2005年以来的分钟线数据。ETF过去20多年以来的市场数据和财务数据。期货从1999年以来的每日行情数据。期货2010年以来的分钟线数据。中国50 ETF、商品期权的日、分钟数据。舆情大数据。 | 提供基于IPython Notebook的研究平台，支持Python，Matlab，Excel。提供API。 | 支持股票、ETF、期货等品种的回测，支持日、分钟级回测。 | 支持日、分钟级别的股票、ETF、期货等品种的模拟交易。 | 提供期货的实盘交易。 | “米筐量化社区”，活跃度较高。 |
| [真格量化](https://quant.pobo.net.cn/login#/) | 主要是商品期货、期货期权、金融期货、股票期权等金融衍生品的数据。 | 支持使用Python进行策略研究。提供API。 | 主要提供期货、期权的日、分钟、Tick级别的回测。 | 使用第三方模拟交易平台，主要提供期货、期权的日级别的回测。 | 主要提供期货的实盘交易。 | “真格量化社区”，活跃度一般。 |

## 4.6、股价常用指标

- 极差：越高说明波动越明显，股价近期最高价的最大值和最小值的差值
- 成交量加权平均价格：英文名VWAP(Volume-Weighted Average Price，成交量加权平均价格)是一个非常重要的经济学量，代表着金融资产的"平均"价格
- 收益率：
    - 简单收益率，相邻两个价格之间的变化率；
    - 对数收益率，指所有价格取对数后两两之间的差值
- 波动率：越高说明波动越明显，波动率是对价格变动的一种衡量
- 年波动率：对数波动率的标准差除以其均值，再除以交易日倒数的平方根,通常交易日取250天
- 月波动率：对数收益率的标准差除以其均值，再乘以交易月的平方根，通常交易月取12月

均线
- 简单移动均线（SMA）：一般用于分析时间序列上的股价趋势，计算股价与等权重的指示函数的卷积
- 指数移动均线（EMA）：历史数据的权重以指数速度衰减，计算股价与权重衰减的指示函数的卷积

## 4.7、股票时间序列

- 时间序列：金融领域最重要的数据类型之一，股价、汇率为常见的时间序列数据，
- 趋势分析：主要分析时间序列在某一方向上持续运动，在量化交易领域,我们通过统计手段对投资品的收益率进行时间序列建模,以此来预测未来的收益率并产生交易信号
- 序列相关性：金融时间序列的一个最重要特征是序列相关性， 以投资品的收益率序列为例,我们会经常观察到一段时间内的收益率之间存在正相关或者负相关

# Python 量化交易

## 系统组成

![](image/量化交易系统组成.png)

# 指标计算

## EMA



## MACD

MACD：Moving Average Convergence/Divergence，意为异同移动平均线。它刻画的是股价变化的速度；

MACD 算法有如下指标：

| 指标     | 含义                  | 公式                              |
| ------ | ------------------- | ------------------------------- |
| 短期 EMA | 短期收盘价指数移动均线 (12 天)  | 前一日 $EMA (12)*11/13 + 今日收盘价*2/13$ |
| 长期 EMA | 长期收盘价指数移动均线 (26 天)  | 前一日 $EMA (26)*25/27 + 今日收盘价*2/27$ |
| DIF    | 短期 EMA 与长期 EMA 差值   | $EMA(12) - EMA(26)   $            |
| DEA    | DIF 线的 M 日指数移动均线    | 前一日 $DEA*8/10 + 今日 DEA*2/10$      |
| MACD   | DIF 线与 DEA 线的差 * 2 |  $(DIF - DEA) * 2$   |

实现 MACD 的主要函数：
- **ewm函数**：Pandas中指数加权移动窗口函数，采用ewm函数 + mean（）快捷计算MACD
- **bar函数**：Matplotlib柱状图函数，高效绘制MACD中的柱状图

# 课程

- [Datawhale量化开源课程](https://github.com/datawhalechina/whale-quant)

# 资讯

- [The PyQuant Newsletter](https://www.pyquantnews.com/)

# 参考资料

- [Quant-Wiki 开源的中文量化百科](https://github.com/LLMQuant/quant-wiki)
- [VNPY-量化交易平台](https://github.com/vnpy/vnpy)
- [基于Java的AI开源量化交易平台](https://gitee.com/dromara/northstar/)
- [Qlib 是一个以 AI 为导向的量化投资平台，旨在利用 AI 技术赋能量化研究，从探索想法到实施生产](https://github.com/microsoft/qlib)
- [一套用于量化金融的高质量工具](https://github.com/quarkfin/qf-lib)
- [nautilus_trader-开源交易平台、策略回测](https://github.com/nautechsystems/nautilus_trader)
- [Panda AI Agent-量化投资助手](https://www.pandaai.online/)
- [Qbot：AI智能量化投研平台](https://github.com/UFund-Me/Qbot)
- [量化交易策略](https://github.com/qmhedging/poboquant)
- [Awesome Quant GitHub 包含 Quants（定量金融）的精选库、包和资源列表](https://github.com/wilsonfreitas/awesome-quant)
- [150+ 量化金融 Python 程序，帮助您收集、作和分析股市数据](https://github.com/shashankvemuri/Finance)
- [算法交易机器学习代码](https://github.com/stefan-jansen/machine-learning-for-trading)
- [量化交易](https://github.com/je-suis-tm/quant-trading)
- [Tidy Finance with Python](https://www.tidy-finance.org/python/)