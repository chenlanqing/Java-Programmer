<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**目录**

- [1.OSI 七层模型:](#1osi-%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B)
  - [1.1.OSI(Open System Interconnection):](#11osiopen-system-interconnection)
  - [1.2.TCP/IP 协议:](#12tcpip-%E5%8D%8F%E8%AE%AE)
- [2.TCP 协议](#2tcp-%E5%8D%8F%E8%AE%AE)
- [3.TCP 三次握手和四次挥手](#3tcp-%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E5%92%8C%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B)
  - [3.1.三次握手:](#31%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B)
  - [3.2.四次挥手:断开TCP连接](#32%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E6%96%AD%E5%BC%80tcp%E8%BF%9E%E6%8E%A5)
  - [3.3.为什么要三次握手:](#33%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B)
  - [3.4.为什么要四次挥手:](#34%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B)
  - [3.5.为什么建立连接协议是三次握手,而关闭连接却是四次挥手呢?](#35%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%E5%8D%8F%E8%AE%AE%E6%98%AF%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E8%80%8C%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%E5%8D%B4%E6%98%AF%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E5%91%A2)
- [参考资料](#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->



# 1.OSI 七层模型:
## 1.1.OSI(Open System Interconnection):
    称为开放式系统互联参考模型,针对广域网通信进行设计的,将整个网络通信
    份名为7个层次:物理层、数据链路层、网络层、传输层、会话层、表示层、应用层.
    (1).OSI 低四层(从物理层到传输层)定义了如何进行端到端的数据传输,也就是定义了如何通过网卡、物理电缆、
        交换机和路由器进行数据传输.
    (2).而高三层(从会话层到应用层)定义了终端系统的应用程序和用户如何彼此通信,即定义了如何重建从发送方
        到目的方的应用程序数据流
    1.1.1.物理层:是所有计算机网络体系结构的最底层,为所有网络/数据通信提供物理的通信线路.
        是用来构建计算机网络通信和数据传输的通道的.
        中继器,集线器、网线、HUB
    1.1.2.数据链路层:控制网络层与物理层之间的通信,提供点对点的数据传输通道,通过MAC地址寻址把数据传到
        目的节点.为了保证传输,从网络层接收到的数据被分割成特定的可被物理层传输的帧.
        (1).数据链路层在不可靠的物理介质上提供可靠的传输.
            该层的作用包括:物理地址寻址、数据的成帧、流量控制、数据的检错、重发等
        (2).据链路层协议的代表包括:SDLC、HDLC、PPP、STP、帧中继等;
        (3).数据链路可以分为逻辑链路和物理链路.
            网卡,网桥,交换机
    1.1.3.网络层:
        (1).其主要功能是将网络地址翻译成对应的物理地址,并决定如何将数据从发送方路由到接收方
        (2).在网络中,"路由"是基于编址方案、使用模式以及可达性来指引数据的发送.
        (3).网络层是可选的,它只用于当两个计算机系统处于不同的由路由器分割开的网段这种情况,或者当通信应用
            要求某种网络层或传输层提供的服务、特性或者能力时
    1.1.4.传输层:
        (1).以端到端方式建立数据传输连接和通信,屏蔽途径网络中所有低层服务上的差异
        (2).以数据段为基本格式提供流量控制,拥塞控制和差错控制
        (3).传输层的协议:TCP,UDP
    1.1.5.会话层
        (1).维护通信双方应用进程会话;管理双方数据交换进程
        (2).建立通信链接,保持会话过程通信链接的畅通,同步两个节点之间的对话,决定通信是否被中断以及通信
            中断时决定从何处重新发送
            SESSION认证、断点续传
    1.1.6.表示层:数据将按照网络能理解的方案进行格式化
        (1).数据格式转换,数据加密与解密,数据压缩与解压缩
    1.1.7.应用层:是最靠近用户的OSI层
        (1).负责接受用户的各种网络应用进程的调用;
        (2).协议:FTP,SMTP,HTTP
## 1.2.TCP/IP 协议:
    TCP/IP 协议体系结构,是专门针对使用TCP/IP 协议簇的广域网计算机网络而开发的.其只划分了四层:
    应用层、传输层、网际互连层、网络访问层
    1.2.1.应用层:
        将OSI参考模型中的会话层和表示层的功能合并到应用层实现
    1.2.2.传输层:
        传输层的功能是使源端主机和目标端主机上的对等实体可以进行会话
    1.2.3.网际互连层:
        (1).网络互连层是整个 TCP/IP 协议栈的核心.它的功能是把分组发往目标网络或主机
        (2).定义了分组格式和协议,即IP协议(Internet Protocol)
    1.2.4.网络访问层
# 2.TCP 协议
    
# 3.TCP 三次握手和四次挥手
## 3.1.三次握手:
    在TCP/IP 协议中,TCP 协议提供可靠的连接服务,连接是通过三次握手进行初始化的.
    三次握手的目的是同步连接双方的序列号和确认号并交换 TCP 窗口大小信息
    (1).第一次握手:建立连接
        客户端发送连接请求报文段,将 SYN 位置为1,Sequence Number 为 x; 然后,客户端进入 SYN_SEND 状态,等待服务器的确认;
    (2).第二次握手:服务器收到 SYN 报文段
        服务器收到客户端的 SYN 报文段,需要对这个 SYN 报文段进行确认,设置 Acknowledgment Number为 x+1(Sequence Number+1);
        同时,自己自己还要发送SYN请求信息,将 SYN 位置为1,Sequence Number为y;
        服务器端将上述所有信息放到一个报文段(即 SYN+ACK 报文段)中,一并发送给客户端,此时服务器进入 SYN_RECV 状态;
    (3).第三次握手:客户端收到服务器的 SYN+ACK 报文段
        然后将 Acknowledgment Number 设置为 y+1,向服务器发送 ACK 报文段,这个报文段发送完毕以后,
        客户端和服务器端都进入 ESTABLISHED 状态,完成TCP三次握手
## 3.2.四次挥手:断开TCP连接
    (1).第一次挥手:
        主机1(可以使客户端，也可以是服务器端),设置 Sequence Number 和 Acknowledgment Number,向主机2发送一个 FIN 报文段;
        此时,主机1进入 FIN_WAIT_1 状态;这表示主机1没有数据要发送给主机2了;
    (2).第二次挥手:
        主机2收到了主机1发送的 FIN 报文段,向主机1回一个 ACK 报文段,Acknowledgment Number 为 Sequence Number 加1;
        主机1进入 FIN_WAIT_2 状态;主机2告诉主机1,我"同意"你的关闭请求;
    (3).第三次挥手:
        主机2向主机1发送 FIN 报文段,请求关闭连接,同时主机2进入 LAST_ACK 状态;
    (4).第四次挥手:
        主机1收到主机2发送的 FIN 报文段,向主机2发送 ACK 报文段,然后主机1进入 TIME_WAIT 状态;
        主机2收到主机1的ACK报文段以后,就关闭连接;
        此时,主机1等待2MSL后依然没有收到回复,则证明Server端已正常关闭,那好,主机1也可以关闭连接了
## 3.3.为什么要三次握手:
    为了防止已失效的连接请求报文段突然又传送到了服务端,因而产生错误.防止了服务器端的一直等待而浪费资源
    如:client发出的第一个连接请求报文段并没有丢失,而是在某个网络结点长时间的滞留了,以致延误到连接释放以后的某个时间才到达server
## 3.4.为什么要四次挥手:
    TCP 协议是一种面向连接的、可靠的、基于字节流的运输层通信协议.TCP 是全双工模式
## 3.5.为什么建立连接协议是三次握手,而关闭连接却是四次挥手呢?
    (1).这是因为服务端的 LISTEN 状态下的 SOCKET 当收到 SYN 报文的连接请求后,它可以把ACK和SYN(ACK起应答作用,而SYN起同步作用)
        放在一个报文里来发送.
    (2).但关闭连接时,当收到对方的 FIN 报文通知时,它仅仅表示对方没有数据发送给你了;
        但未必你所有的数据都全部发送给对方了,所以你可能未必会马上会关闭SOCKET,也即你可能还需要发送一些数据给对方之后,
        再发送FIN报文给对方来表示你同意现在可以关闭连接了,所以它这里的ACK报文和FIN报文多数情况下都是分开发送的

# 参考资料

* http://www.cnblogs.com/lemo-/p/6391095.html
* http://www.cnblogs.com/zmlctt/p/3690998.html
* http://www.cnblogs.com/BlueTzar/articles/811160.html
* http://www.jellythink.com/archives/705