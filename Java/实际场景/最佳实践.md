## 1、图片上传问题

在有用户图片上传的功能时，用户上传的图片需要第一时间显示，但是由于浏览器端有缓存，所以当用户上传后，需要在图片后面加一个时间戳，以此刷新客户端的图片缓存，否则用户在上传成功后依然显示老的图片；

另外上传时需要对图片进行校验：
- 基本校验：图片后缀名的校验；
- 深度校验：图片格式校验，通过文件的二进制流进行判断，每个文件都有独有的二进制流；

## 2、关于线上数据删除

账号分离。这样做的目的是，避免写错命令：
- 只给业务开发同学 DML 权限，而不给 truncate/drop 权限。而如果业务开发人员有 DDL 需求的话，也可以通过开发管理系统得到支持；
- 即使是 DBA 团队成员，日常也都规定只使用只读账号，必要的时候才使用有更新权限的账号；

制定操作规范。这样做的目的，是避免写错要删除的表名：
- 在删除数据表之前，必须先对表做改名操作。然后，观察一段时间，确保对业务无影响以后再删除这张表。
- 改表名的时候，要求给表名加固定的后缀（比如加 _to_be_deleted)，然后删除表的动作必须通过管理系统执行。并且，管理系删除表的时候，只能删除固定后缀的表

备份脚本、执行脚本、验证脚本和回滚脚本

## 3、CPU某个时段突然飙高，数据连接池连接数飙升?

- 原因有两个
    - 管理后台导出数据引起的，导出的数据量太大(大概600万)，导出是异步的，但是后台需要去计算count，每个excel文件限制是5000条数据，计算文件数量有1200个excel文件，还需要将文件打包，涉及到很多磁盘IO，而且由于前端没有限制点击次数，导致用户频繁点击，从而实际导出的数据量远大于600万；
    - 另一个是数据库查询SQL慢问题

- 临时解决方案
    - 对慢SQL进行相应的优化操作；
    - 限制用户导出次数，只能导出一次.
    - 限制每次导出的数据量不能超过10万条数据；

- 后续解决方案:
   - 数据库读写分离；
    - 应用分离：之前所有应用都是部署在一台服务器上，把管理后台与移动终端应用分开部署，管理后天与移动终端后台互不影响

## 4、tomcat参数设置问题

之前在一个群里，有人返回说：HTTP调用 使老年代爆满，有人提出了一个思路：是否有修改： max-http-header-size

该网友设置的参数是：
```
server:
  max-http-header-size: 209715200
```
也就说：tomcat并发线程*200M，以100个并发算就要你20G的内存了