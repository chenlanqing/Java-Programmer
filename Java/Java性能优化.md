
# 一、性能调优理论基础

所谓性能，就是使用有限的资源在有限的时间内完成工作

## 1、基本

- 借助监控预防问题、发现问题；
- 借助工具定位问题；
- 定期复盘，防止同类问题再现；
- 定好规范，一定程度上规避问题；


## 2、性能优化衡量指标

### 2.1、吞吐量和响应速度

在交通非常繁忙的情况下，十字路口是典型的瓶颈点，当红绿灯放行时间非常长时，后面往往会排起长队。从我们开车开始排队，到车经过红绿灯，这个过程所花费的时间，就是`响应时间`。当然，我们可以适当地调低红绿灯的间隔时间，这样对于某些车辆来说，通过时间可能会短一些。但是，如果信号灯频繁切换，反而会导致单位时间内通过的车辆减少，换一个角度，我们也可以认为这个十字路口的车辆吞吐量减少了；

- 响应速度是串行执行的优化，通过优化执行步骤解决问题；
- 吞吐量是并行执行的优化，通过合理利用计算资源达到目标；

### 2.2、响应时间衡量

**平均响应时间**

它的本质是把所有的请求耗时加起来，然后除以请求的次数。举个最简单的例子，有 10 个请求，其中有 2 个 1ms、3 个 5ms、5 个 10ms，那么它的平均耗时就是`(2*1+3*5+5*10)/10=6.7ms`

**百分位数**

圈定一个时间范围，把每次请求的耗时加入一个列表中，然后按照从小到大的顺序将这些时间进行排序。这样，取出特定百分位的耗时，这个数字就是 TP 值。可以看到，TP 值(Top Percentile)和中位数、平均数等是类似的，都是一个统计学里的术语；

一般分为 TP50、TP90、TP95、TP99、TP99.9 等多个段，对高百分位的值要求越高，对系统响应能力的稳定性要求越高；

### 2.3、并发量

并发量是指系统同时能处理的请求数量，这个指标反映了系统的负载能力

### 2.4、秒开率

在移动互联网时代，尤其对于 App 中的页面，秒开是一种极佳的用户体验。如果能在 1 秒内加载完成页面，那用户可以获得流畅的体验，并且不会产生更多的焦虑感

### 2.5、正确性

## 3、理论方法

### 3.1、木桶理论

一只木桶若想要装最多的水，则需要每块木板都一样长而且没有破损才行。如果有一块木板不满足条件，那么这只桶就无法装最多的水。

能够装多少水，取决于最短的那块木板，而不是最长的那一块。

木桶效应在解释系统性能上，也非常适合。组成系统的组件，在速度上是良莠不齐的。系统的整体性能，就取决于系统中最慢的组件。

比如，在数据库应用中，制约性能最严重的是落盘的 I/O 问题，也就是说，硬盘是这个场景下的短板，我们首要的任务就是补齐这个短板

### 3.2、基准测试、预热

基准测试(Benchmark)并不是简单的性能测试，是用来测试某个程序的最佳性能。

应用接口往往在刚启动后都有短暂的超时。在测试之前，我们需要对应用进行预热，消除 JIT 编译器等因素的影响。而在 Java 里就有一个组件，即 JMH，就可以消除这些差异

## 4、优化注意点

- 依据数字而不是猜想：进行性能优化时，我们一般会把分析后的结果排一个优先级（根据难度和影响程度），从大处着手，首先击破影响最大的点，然后将其他影响因素逐一击破

- 个体数据不足信：

    这是因为个体请求的小批量数据，可参考价值并不是非常大。响应时间可能因用户的数据而异，也可能取决于设备和网络条件。

    合理的做法，是从统计数据中找到一些规律，比如上面所提到的平均响应时间、TP 值等，甚至是响应时间分布的直方图，这些都能够帮我们评估性能质量

- 不要过早优化和过度优化：正确的做法是，项目开发和性能优化，应该作为两个独立的步骤进行，要做性能优化，要等到整个项目的架构和功能大体进入稳定状态时再进行

- 保持良好的编码习惯：保持好的编码规范，就可以非常方便地进行代码重构；使用合适的设计模式，合理的划分模块，就可以针对性能问题和结构问题进行聚焦、优化



# 二、优化工具



## 2、应用性能调优-监控工具

### 2.1、Skywalking

[参考](分布式架构/分布式.md#2skyWalking)

### 2.2、SpringBoot Actuator

### 2.3、Javamelody

### 2.4、Tomcat Manager

https://gitee.com/chenlanqing/platform

PSI Probe

## 3、JVM调优

## 4、数据库调优

## 5、架构调优

## 6、操作系统调优

## 7、性能调优技巧

- 池化技术
- 异步化
- 锁优化

# switch 与 if 性能比较

https://mp.weixin.qq.com/s/JkqKg4ZdHBLP_u2COZ4oPw


[性能优化](https://xie.infoq.cn/article/a0d418bf29915ecad5d5eeab0)

