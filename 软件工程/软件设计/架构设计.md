# 一、架构基础

架构设计的关键思维是判断和取舍，程序设计的关键思维是逻辑和实现

## 1、基本概念

### 1.1、系统与子系统

- 系统：泛指由一群有`关联`的个体组成，根据某种`规则`运作，能完成个别原件不能单独完成的工作的群体。它的意思是“总体”、“整体”或联盟
    - `关联`：系统是由一群有关联的个体组成的，没有关联的个体堆在一起不能成为一个系统；
    - `规则`：系统内的个体需要按照指定的规则运作，而不是单个个体各自为政。规则规定了系统内个体分工和协作的方式
    - `能力`：系统能力与个体能力有本质的差别，系统能力不是个体能力之和，而是产生了新的能力
- 子系统：由一群有关联的个体所组成的系统，多半会是更大系统中的一部分；

其实子系统的定义和系统的定义是一样的，只是观察的角度有差异，一个系统可能是另外一个更大系统的子系统；

按照这个定义，系统和子系统比较容易理解，以微信为例来做一个分析：
- 微信本身是一个系统，包含聊天、登录、支付、朋友圈等子系统。
- 朋友圈这个系统又包括动态、评论、点赞等子系统。
- 评论这个系统可能又包括防刷子系统、审核子系统、发布子系统、存储子系统。
- 评论审核子系统不再包含业务意义上的子系统，而是包括各个模块或者组件，这些模块或者组件本身也是另外一个维度上的系统。例如，MySQL、Redis 等是存储系统，但不是业务子系统。

> 一个系统的架构，只包括顶层这一个层级的架构，而不包括下属子系统层级的架构；

### 1.2、模块与组件

- 模块：是一套一致而互相有紧密关联的软件组装。它分别包含了`程序和数据结构`两部分。现代软件开发往往利用模块作为合成单位。模块的接口表达了由该模块提供的功能和调用它时所需的元素。模块是可能分开被编写的单位。这使它们可再用和允许人员同时协作、编写及研究不同的模块
- 组件：定义为自包含的、可编程的、可重用的、与语言无关的软件单元，软件组件可以很容易的被用于组装应用程序中。

模块和组件都是系统的组成部分，只是从不同的角度拆分系统而已；
- 从业务逻辑的角度来拆分系统后，得到的单元就是“模块”；
- 从逻辑角度来拆分系统，得到的单元就是“模块”；
- 从物理的角度来拆分系统后，得到的单元就是“组件”。<br/>
划分模块的主要目的是职责分离；划分组件的主要目的是复用；

作为业务系统的架构师，首先需要思考怎么从业务逻辑的角度把系统拆分成一个个模块角色，其次需要思考怎么从物理部署的角度把系统拆分成组件角色，比如MySQL

### 1.3、框架与架构

- 软件框架通常指的是为了实现某个业界标准或完成特定基本任务的软件组件规范，也指为了实现某个软件组件规范时，提供规范所要求之基础功能的软件产品；<br>
    关键点：
    - 框架是组件规范，例如MVC；
    - 框架提供基础功能产品，例如SpringMVC是MVC开发框架；
- 软件架构是指软件系统的基础架构，创造这些基础结构的准则，以及对这些结构的描述；

框架和架构的区别还是比较明显的：框架关注的是“规范”，架构关注的是“结构”；框架的英文是 Framework ，架构的英文是 Architecture ；

> 总结：框架是一整套开发规范，架构是某一套开发规范下的具体落地方案，包括各个模块之间的组合关系以及它们协同起来完成功能的运作规则。

### 1.4、软件架构

软件架构指软件系统的顶层（Rank）结构，它定义了系统由哪些角色（Role）组成，角色之间的关系（Relation）和运作规则（Rule）。
- Rank：它是指软件架构是分层的，对应“系统”和“子系统”的分层关系。通常情况下，只需要关注某一层的架构，最多展示相邻两层的架构，而不需要把每一层的架构全部糅杂在一起。无论是架构设计还是画架构图，都应该采取“自顶向下，逐步细化”的方式
- Role：它是指软件系统包含哪些角色，每个角色都会负责系统的一部分功能；架构设计最重要的工作之一就是将系统拆分为多个角色
- Relation：它是指软件系统的角色之间的关系，对应到架构图中其实就是连接线，角色之间的关系不能乱连，任何关系最后都需要代码来实现；
- Rule：它是指软件系统角色之间如何协作来完成系统功能

在实际工作中，Rank、Role 和 Relation 是通过系统架构图来展示的，而 Rule 是通过系统序列图（System Sequence Diagram）来展示的。





## 2、业务架构、应用架构、技术架构

- 业务架构就是讲清楚核心业务的处理过程，定义各个业务模块的相互关系，它从概念层面帮助我们理解系统面临哪些问题以及如何处理；
- 应用架构就是讲清楚系统内部是怎么组织的，有哪些应用，相互间是怎么调用的，它从逻辑层面帮助我们理解系统内部是如何分工与协作的；
- 技术架构就是讲清楚系统由哪些硬件、操作系统和中间件组成，它们是如何和我们开发的应用一起配合，应对各种异常情况，保持系统的稳定可用。所以，技术架构从物理层面帮助我们理解系统是如何构造的，以及如何解决稳定性的问题；

业务架构给出了业务模块的划分和依赖关系，这也大致决定了应用系统如何分工和协作，当然这不需要严格地一一对应，比如一个商品业务，可能对应 3 个应用，一个前台商品展示应用、一个后台商品管理应用，以及一个商品基础服务，但这不影响我们从逻辑上理解，一个业务场景，有哪些应用参与，并且它们是如何协作的。

而技术架构呢，通过保障应用的稳定运行，最终保证业务不出问题。比如在大促的时候，多个应用可能会受大流量冲击，技术架构就要考虑怎么通过技术手段，保障相关的应用能够处理高并发，从而保证大促顺利进行；

> 所以做架构设计时，一般是先考虑业务架构，再应用架构，最后是技术架构

## 3、架构原则

架构原则是指用于指导软件架构设计和开发的一系列准则或规则。

这些原则旨在确保所产生的架构具有可维护性、可扩展性，并且易于理解和修改。一些常见的架构原则包括关注点分离、模块化、松耦合和高内聚。此外，架构原则通常与设计模式结合使用，设计模式是常见软件设计问题的可重用解决方案

## 4、架构风格

软件的架构风格是指软件系统的整体设计和组织，以及用于指导设计的原则和模式。这些风格为系统设计提供了总体框架，可用于确保系统具有良好的结构性、可维护性和可扩展性：
- 微服务架构
- 事件驱动
- 分层架构
- 面向服务
- 以数据为中心
- 基于组件
- 领域驱动

## 5、架构模式

架构模式是一套已被证明适用于特定类型软件系统的解决方案。它们为设计和构建软件系统提供了一个通用词汇表和一套最佳实践，可以帮助开发人员做出更好的设计决策。一些常见的架构模式包括：
- MVC模式
- 微服务
- 事件驱动
- 分层
- 管道与过滤器
- 命令-查询责任隔离
- 微内核
- Serverless
- 消息队列与消息流
- 事件源

## 6、架构图

- [常见架构图](https://mp.weixin.qq.com/s/6Jh0EHdbjZb47DCsplwS_A)

常见架构图：
- 业务架构图
- 功能架构图
- 产品架构图
- 应用架构图
- 系统架构图
- 技术架构图
- 信息架构图
- 数据架构图

# 二、高可用架构

高可用本质上是通过“冗余”来实现的

## 1、服务降级


## 2、限流


## 3、超时和重试机制


## 4、回滚机制

## 5、服务容错

## 6、自动重启




# 参考资料

* [凤凰架构-构建可靠的大型分布式系统](http://icyfenix.cn/)
* [架构的演进](https://www.cnblogs.com/hafiz/p/9222973.html)
* [如何画架构图](https://developer.aliyun.com/article/765140?spm=a2c6h.12873639.0.0.75482c6dlmkDa6)
* [分布式架构知识体系](https://developer.aliyun.com/article/721007?spm=a2c6h.12873639.0.0.75482c6dlmkDa6)
* [架构设计实践](https://www.infoq.cn/article/RQDwWxDcwbxtwU8LBFSG)
* [如何做技术选型](https://juejin.im/post/6870288195674718222)
* [如何画架构图](https://juejin.cn/post/6844904127856640014)
* [软件架构-RoadMap](https://roadmap.sh/software-architect)
* [COLA架构-整洁面向对象分层架构-应用案例](https://github.com/alibaba/COLA)
* [C4模型](https://c4model.com/)
* [《架构整洁之道》](https://github.com/leewaiho/Clean-Architecture-zh)
